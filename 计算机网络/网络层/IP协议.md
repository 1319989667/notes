# IPv4数据报格式

版首服总（扳手服总）

标标片

TTL协议首检和

源IP 目的IP

![IMG_20230307_140329](C:\Users\Kirua\Documents\Tencent Files\1319989667\FileRecv\MobileFile\IMG_20230307_140329.jpg)

版本（4位）：指明是IPv4还是IPv6

首部长度（4位）：单位为4个字节。一般为5×4＝20字节，最大为15×4=60字节。

区分服务（8位）：很少使用。

总长度（16位）：包括首部与数据的整个IP数据报长度，单位为字节。不过由于以太网帧数据的最大长度是1500字节，所以很少超过这个数值。

标识（16位）：序列号

标志（3位）：用于IP数据报的分片与还原。

片偏移（13位）：以8字节为单位。

生存时间（8位）：也叫TTL，每经过一个路由器-1，直到为0就丢弃该数据报。

协议（8位）：IP协议实体根据本字段决定把数据部分交给哪个运输层实体。如果值是十进制的6，交给TCP协议实体；值是17，则交给UDP协议实体。

首部检验和（16位）：将首部检验和置为0，将首部拆分为多个16位的单元，所有单元相加，若有超过16位的进位就加到和的最低位，按位取反就是检验和。

源IP地址（32位）

目的IP地址（32位）



# IP地址分类

## 私有IP地址

10.0.0~10.255.255.255

172.16.0.0~172.31.255.255

192.168.0.0~192.168.255.255

169.254.0.0~169.254.255.255（自动私有IP地址）

## 公有IP地址

| 类别 | 网络号长度 | 主机号长度 | 起止范围                  |
| ---- | ---------- | ---------- | ------------------------- |
| A    | 8          | 24         | 1.0.0.0~126.255.255.255   |
| B    | 16         | 16         | 128.0.0.0~191.255.255.255 |
| C    | 24         | 8          | 192.0.0.0~223.255.255.255 |
| D    | -          | -          | 224.0.0.0~239.255.255.255 |
| E    | -          | -          | 240.0.0.0~255.255.255.255 |

A类开头是0，B类开头10，C类开头110，D类开头1110，E类开头1111

不过ABC三类地址的主机数量差异过大，引入CIDR（无分类域间选路）解决这个问题。 网络号：主句号/子网掩码

主机号全为0的是网络IP地址，主机号全为1的是广播地址

## 环回地址

127.0.0.1 ~ 127.255.255.255



# IPv6的IP数据报格式

版流流

长下跳

源IP

目的IP

![image-20230307151040906](C:\Users\Kirua\AppData\Roaming\Typora\typora-user-images\image-20230307151040906.png)

流量类型：与IPv4的区分服务类似，目的是区分与IPv6数据报不同的类别和优先级。



# IPv4与IPv6的比较

| 协议 | 地址长度 | 资源预留 | 路由器分片 | 差错检测 |
| ---- | -------- | -------- | ---------- | -------- |
| IPv4 | 32位     | 不支持   | 可以       | 有       |
| IPv6 | 128位    | 支持     | 不可以     | 无       |



# 从IPv4向IPv6过渡

双协议栈、隧道技术。

双协议栈：计算机、路由器同时运行IPv4和IPv6。会进行IPv4地址与IPv6地址的转化。

隧道技术：不进行IPv4地址与IPv6地址的转换。而是把IPv6数据报封装在IPv4数据报中传输。不过仍要求路由器同时运行IPv4和IPv6。